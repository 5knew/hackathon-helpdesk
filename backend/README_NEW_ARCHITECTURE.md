# üèóÔ∏è –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:

### üìä –¢–∞–±–ª–∏—Ü—ã (11 —à—Ç—É–∫)

1. ‚úÖ **tickets** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ç–∏–∫–µ—Ç–æ–≤
2. ‚úÖ **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–∫–ª–∏–µ–Ω—Ç—ã –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
3. ‚úÖ **departments** - –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
4. ‚úÖ **operators** - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã 2-–π –ª–∏–Ω–∏–∏
5. ‚úÖ **categories** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤
6. ‚úÖ **ml_models** - –º–æ–¥–µ–ª–∏ –ò–ò
7. ‚úÖ **ai_predictions** - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ò–ò
8. ‚úÖ **ai_auto_responses** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
9. ‚úÖ **ticket_messages** - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–∏–∫–µ—Ç–∞—Ö
10. ‚úÖ **daily_stats** - –¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
11. ‚úÖ **training_samples** - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è ML

### üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ SQLAlchemy –º–æ–¥–µ–ª–∏ —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏
- ‚úÖ Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:
  - AI Classifier - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤
  - AI Router - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º
  - Auto Resolver - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ
  - Stats Service - —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ API —Ä–æ—É—Ç–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∏–∫–µ—Ç–∞–º–∏
- ‚úÖ –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ models/              # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ticket.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ department.py
‚îÇ   ‚îú‚îÄ‚îÄ operator.py
‚îÇ   ‚îú‚îÄ‚îÄ category.py
‚îÇ   ‚îú‚îÄ‚îÄ ml_model.py
‚îÇ   ‚îú‚îÄ‚îÄ ai_prediction.py
‚îÇ   ‚îú‚îÄ‚îÄ ai_auto_response.py
‚îÇ   ‚îú‚îÄ‚îÄ ticket_message.py
‚îÇ   ‚îú‚îÄ‚îÄ daily_stat.py
‚îÇ   ‚îî‚îÄ‚îÄ training_sample.py
‚îú‚îÄ‚îÄ schemas/             # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ticket.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ category.py
‚îÇ   ‚îú‚îÄ‚îÄ department.py
‚îÇ   ‚îî‚îÄ‚îÄ operator.py
‚îú‚îÄ‚îÄ routers/             # API —Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ tickets.py
‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ai_classifier.py
‚îÇ   ‚îú‚îÄ‚îÄ ai_router.py
‚îÇ   ‚îú‚îÄ‚îÄ auto_resolver.py
‚îÇ   ‚îî‚îÄ‚îÄ stats_service.py
‚îú‚îÄ‚îÄ database.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL
‚îú‚îÄ‚îÄ init_db.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ main_new.py          # –ù–æ–≤—ã–π main.py
‚îî‚îÄ‚îÄ requirements.txt     # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL

```bash
# –°–æ–∑–¥–∞—Ç—å –ë–î
createdb helpdesk_db

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker
docker run --name postgres-helpdesk \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=helpdesk_db \
  -p 5432:5432 \
  -d postgres:15
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/helpdesk_db
ML_SERVICE_URL=http://localhost:8000
```

### 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

```bash
python init_db.py
```

### 5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å main_new.py
uvicorn main_new:app --host 0.0.0.0 --port 8002

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å run.py
mv main_new.py main.py
python run.py
```

## üìù API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞

```bash
POST /tickets/create
Content-Type: application/json

{
  "source": "email",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "subject": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º",
  "body": "–ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É",
  "language": "ru"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞

```bash
GET /tickets/{ticket_id}
```

### –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤

```bash
GET /tickets?skip=0&limit=50&status=new
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞

```bash
PUT /tickets/{ticket_id}
Content-Type: application/json

{
  "status": "closed",
  "priority": "high"
}
```

## üîÑ Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∏–∫–µ—Ç–∞

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞** ‚Üí `POST /tickets/create`
2. **AI Classifier** ‚Üí –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–∫–∞—Ç–µ–≥–æ—Ä–∏—è, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —Ç–∏–ø)
3. **Business Logic**:
   - –ï—Å–ª–∏ `issue_type = auto_resolvable` ‚Üí –ø–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
   - –ï—Å–ª–∏ `confidence` –Ω–∏–∑–∫–æ–µ ‚Üí —ç—Å–∫–∞–ª–∞—Ü–∏—è
   - –ï—Å–ª–∏ `complex` ‚Üí –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç
4. **Log** ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `ai_predictions`
5. **SLA –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `daily_stats`

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### UUID –≤–º–µ—Å—Ç–æ INTEGER

–í—Å–µ ID —Ç–µ–ø–µ—Ä—å UUID –¥–ª—è –ª—É—á—à–µ–π –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### ENUM —Ç–∏–ø—ã

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç—Ä–æ–≥–∏–µ enum —Ç–∏–ø—ã:
- `TicketSource`: email, chat, portal, phone
- `TicketLanguage`: ru, kk, en
- `TicketPriority`: low, medium, high, critical
- `IssueType`: simple, complex, auto_resolvable
- `TicketStatus`: new, auto_resolved, in_work, waiting, closed

### Relationships

–í—Å–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ SQLAlchemy relationships –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏.

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `daily_stats`:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ—à–µ–Ω–Ω—ã–µ
- –¢–æ—á–Ω–æ—Å—Ç—å –ò–ò
- –û—à–∏–±–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

## üîß –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

- [ ] –î–æ–±–∞–≤–∏—Ç—å Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç–µ—Ä—ã –¥–ª—è users, departments, categories
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–±—É—á–µ–Ω–∏—è ML –Ω–∞ –æ—Å–Ω–æ–≤–µ training_samples
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏: —Å–º. `MIGRATION_GUIDE.md`

